# 背景除去後の「エッジ調整（デフリンジ＋フェザー）」設計

背景除去済みの RGBA 画像で、エッジに元背景色がにじむフリンジを軽減し、白背景になじませるための処理フロー。Photoshop の「Defringe＋マスクに軽いフェザー」を Python で再現するイメージ。

---

## 前提

- 入力:
  - 背景除去済みの **RGBA** 画像（商品は不透明、背景はアルファ0）
- 問題:
  - 商品輪郭の数ピクセルに、除去前の背景色（グレーや別色）がわずかに残っている
  - 白背景に乗せると、エッジがわずかに灰色っぽく浮いて見える
- 目的:
  - 外周の色付きフリンジを 1〜2px 分「削る」
  - かつ、輪郭を少しだけフェザーして白背景と自然につなぐ

---

## 処理の概念

1. **アルファチャンネルを少しだけ縮める（デフリンジ）**
   - 収縮（エロージョン）で輪郭を 1〜2px 内側に寄せる
   - これにより、外側の色付きフリンジが透明寄りになり、中の色で置き換わるイメージ

2. **縮めたアルファを軽くぼかす（フェザー）**
   - 0.5〜1px 程度のガウシアンブラー
   - エッジの切れ味をほんの少し和らげ、白背景との境界をスムーズにする[web:241]

3. **新しいアルファで RGBA を作り直す**
   - `Image.merge` で、RGBはそのまま、新アルファだけ差し替える
   - この「調整済みアルファ」を後段の影生成・白背景合成でもそのまま使う

---

## パラメータの目安

画像サイズを `W × H` としたとき:

- デフリンジ量（アルファ収縮ピクセル数）
  - 小さめの商品写真: 1px
  - 大きめ: 2px まで  
  - Pillow の `MinFilter(3)`（3×3）で約1px収縮イメージ[web:241]

- フェザー（ぼかし半径）
  - `radius ≈ 0.5〜1.0` ピクセル  
  - 大きくしすぎるとボケすぎるので、ごく弱く
